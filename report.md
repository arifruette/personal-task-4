# Отчёт по дисциплине «Архитектура компьютеров и операционных систем» (АКОС)

**Студент:** *Хазеев Амир Айратович*  
**Группа:** *БПИ-247*  
**Вариант:** *Вариант 27*

**Язык программирования:** C  
**Используемая библиотека потоков:** POSIX Threads (pthread)

---

## 1. Условие задачи

**Задача о привлекательной студентке.**  
У одной очень привлекательной студентки есть `N` поклонников. В день святого Валентина студентка проводит романтический вечер с одним из них. С утра каждый поклонник отправляет студентке «валентинку» — предложение с вариантом романтического вечера. Студентка не сообщает решение сразу, а дожидается, пока все поклонники сделают свои предложения. После этого она выбирает наиболее заманчивый вариант и уведомляет всех поклонников о результате: одного — о согласии, остальных — об отказе.

Требуется разработать многопоточное приложение, моделирующее описанную ситуацию, используя парадигму **«клиент–сервер»** с **активным ожиданием**. В протоколе вывода должна быть отражена реакция каждого поклонника на полученный ответ.

---

## 2. Сценарий предметной области (ролевое поведение)

В задаче участвуют следующие сущности:

- **Поклонники** — активные субъекты, каждый из которых:
  - независимо от других обдумывает вариант романтического вечера;
  - формирует и отправляет студентке своё предложение;
  - ожидает ответа, не зная заранее результата;
  - после получения ответа эмоционально реагирует на решение студентки.

- **Студентка** — центральный субъект, который:
  - принимает предложения от всех поклонников;
  - не выдает ответов, пока не будут получены все валентинки;
  - сравнивает полученные предложения;
  - выбирает наиболее привлекательный вариант;
  - рассылает всем поклонникам уведомления о результате.

Все действия поклонников происходят **одновременно**, каждый из них действует независимо. Решение студентки принимается только после завершения активности всех поклонников.

---

## 3. Модель параллельных вычислений

В программе используется модель **многопоточности в одном процессе**:

- каждому поклоннику соответствует **отдельный поток** (клиент);
- студентка реализована в виде **отдельного потока-сервера**;
- взаимодействие потоков осуществляется через **разделяемую память**.

Для синхронизации используются:

- **активное ожидание (spin-wait)** для реализации логики ожидания событий;
- **атомарные переменные (`stdatomic.h`)** для фиксации состояний:
  - факт отправки предложения;
  - факт получения ответа;
- **мьютекс POSIX** для синхронизации вывода в консоль и файл.

---

## 4. Корректное завершение и обработка прерывания

Программа корректно завершает работу после рассылки ответов всем потокам.  
Также предусмотрено корректное завершение по `Ctrl+C` (**SIGINT**): при получении сигнала выполнение останавливается, сервер рассылает всем потокам отказ, после чего программа корректно освобождает ресурсы и завершает работу.

---

## 5. Генераторы случайных чисел и допустимые диапазоны

Для моделирования вариативного поведения используются генераторы псевдослучайных чисел (`rand_r`), диапазоны:

- **время обдумывания поклонником**: `1..3` секунд;
- **оценка привлекательности предложения**: целое число `1..100`;
- **идея романтического вечера**: случайный выбор из фиксированного набора строк.

Случайные значения интерпретируются как индивидуальные особенности и предпочтения поклонников.

---

# Раздел для оценки 4–5 баллов

## 6. Входные данные (4–5)

- `N` — количество поклонников, допустимый диапазон: `1 ≤ N ≤ 1000`.

Число поклонников `N` **не является фиксированным параметром задачи** и задаётся **при запуске программы через аргументы командной строки**, что соответствует общему требованию:

> «Когда число потоков, реализующих то или иное действие не является точно заданным, необходимое значение можно задавать в аргументах командной строки программы».

Таким образом, использование аргументов командной строки для задания параметра `N` является корректным и допустимым для уровня **4–5 баллов**.

## 7. Сборка и запуск (4–5)

```bash
cd 4-5
gcc -std=c17 -pthread main.c -o main
./main <число_поклонников>
````

### Результаты тестирования
![](/4-5/45test.png)

---

# Раздел для оценки 6–7 баллов

## 8. Изменения относительно уровня 4–5

Для соответствия требованиям **6–7 баллов** выполнены следующие доработки:

* реализован ввод исходных данных **через аргументы командной строки**;
* добавлена генерация случайных данных в допустимых диапазонах;
* обеспечена воспроизводимость сценариев при использовании фиксированного `SEED`.

## 9. Входные данные (6–7)

Параметры командной строки:

* `N` — количество поклонников (`1..1000`);
* `SEED` — необязательный параметр (целое число), задающий начальное состояние генератора случайных чисел.

Формат запуска:

```text
./main N [SEED]
```

## 10. Сборка и запуск (6–7)

```bash
gcc -std=c17 -pthread main.c -o main
./main 10
./main 10 12345
```

## 11. Результаты работы (6–7)

![](/6-7/67test.png)

Второй запуск с тем же SEED

![](/6-7/67test2.png)
---

# Раздел для оценки 8 баллов

## 12. Изменения относительно уровня 6–7

Для соответствия требованиям **8 баллов** выполнены следующие доработки:

- добавлен вывод результатов **в файл**, при этом результаты **одновременно выводятся в консоль и записываются в файл**;
- реализован альтернативный ввод исходных данных **из файла конфигурации**;
- расширен ввод из командной строки: добавлены ключи для управления режимом ввода (из CLI или из файла) и задания имени выходного файла;
- подготовлены не менее **трёх** вариантов входных и выходных файлов (см. раздел 17).

## 13. Расширенный ввод из командной строки (8)

Программа поддерживает управление вводом через ключи командной строки.

### 13.1. Вывод в файл

Имя файла для вывода задаётся отдельным параметром командной строки:

- `-o <output_file>` — файл, в который записывается протокол работы программы.  
  При этом **все сообщения остаются в консоли** и **дублируются в файл**.

### 13.2. Ввод параметров из командной строки

- `-n <N>` — количество поклонников (`1 ≤ N ≤ 1000`);
- `-s <SEED>` — необязательный seed генератора случайных чисел (целое число).

### 13.3. Ввод параметров из конфигурационного файла

- `-c <config_file>` — конфигурационный файл.  
  Если указан ключ `-c`, параметры `-n` и `-s` **не вводятся** (игнорируются), т.к. параметры берутся из конфигурационного файла.

## 14. Формат конфигурационного файла (8)

Конфигурационный файл является текстовым файлом и содержит пары `ключ=значение`.

Поддерживаемые параметры:

- `N=<число>` — количество поклонников (`1..1000`);
- `SEED=<число>` — seed генератора случайных чисел.

Пример содержимого файла конфигурации:

```text
N=10
SEED=12345
```

## 15. Примеры входных и выходных файлов (8)

В рамках требований 8 баллов подготовлены минимум три набора входных/выходных файлов.

Ниже приведены варианты (файлы размещаются в каталоге решения уровня 8 баллов):

### Вариант 1

* Вход: `config1.txt`
* Выход: `out1.txt`

Пример запуска:

```bash
cd 8
gcc -std=c17 -pthread main.c -o main
./main -c config1.txt -o out1.txt
```

Результат:
![](/8/tests/test1.png)

Вид out1.txt (также есть в директории)
![](/8/tests/out1.png)

### Вариант 2

* Вход: `config2.txt`
* Выход: `out2.txt`

Пример запуска:

```bash
cd 8
gcc -std=c17 -pthread main.c -o main
./main -c config2.txt -o out2.txt
```

Результат:
![](/8/tests/test2.png)

Вид out2.txt (также есть в директории)
![](/8/tests/out21.png)
![](/8/tests/out22.png)

### Вариант 3

* Вход: `config3.txt`
* Выход: `out3.txt`

Пример запуска:

```bash
cd 8
gcc -std=c17 -pthread main.c -o main
./main -c config3.txt -o out3.txt
```

Результат:
![](/8/tests/test3.png)

Вид out3.txt (также есть в директории)
![](/8/tests/out31.png)
![](/8/tests/out32.png)

## 16. Сборка и запуск (8)

Сборка выполняется через `gcc`:

```bash
cd 8
gcc -std=c17 -pthread main.c -o main
```

Запуск в режиме ввода из командной строки:

```bash
./main -n 10 -s 12345 -o out_cli.txt
```

Результат:
![](/8/tests/test4.png)

Вид out_cli.txt (также есть в директории)
![](/8/tests/out_cli.png)

Запуск в режиме ввода из файла конфигурации:

```bash
./main -c config.txt -o out_cfg.txt
```

---

# Раздел для оценки 9–10 баллов

## 17. Альтернативная реализация с использованием других синхропримитивов

Для получения оценки **9–10 баллов** была разработана **вторая версия программы**, реализующая **ту же самую предметную логику**, но построенная **на других механизмах синхронизации потоков**.

Если в предыдущей версии (уровень 8 баллов) взаимодействие потоков основывалось на:

* активном ожидании (spin-wait);
* атомарных флагах (`stdatomic.h`);

то в альтернативной реализации использованы:

* **условные переменные POSIX (`pthread_cond_t`)**;
* **мьютексы POSIX (`pthread_mutex_t`)** для защиты разделяемых данных.

Таким образом, реализовано **альтернативное решение**, удовлетворяющее требованиям задания.

---

## 18. Используемые синхропримитивы (9–10)

В альтернативной версии применяются следующие механизмы синхронизации:

* **мьютекс** — для защиты общих структур данных (массивов предложений и ответов, счётчиков состояния);
* **условная переменная `pthread_cond_t`** — для ожидания наступления событий:

  * получения всех предложений от поклонников;
  * готовности ответов студентки;
* **обработка сигнала `SIGINT`** — сохранена без изменений, как и в версии на 8 баллов.

Активное ожидание в потоках **не используется** — вместо него потоки переводятся в состояние ожидания с помощью `pthread_cond_wait`, что снижает нагрузку на процессор и демонстрирует иной подход к синхронизации.

---

## 19. Сборка и запуск альтернативной версии (9–10)

Сборка выполняется стандартным компилятором `gcc`:

```bash
cd 9-10
gcc -std=c17 -pthread main.c -o main
```

Запуск аналогичен версии на 8 баллов.

Пример запуска с параметрами командной строки:

```bash
./main -n 10 -s 12345 -o out_alt.txt
```

Результат:
![](/9-10/tests/test1.png)

Вид out_alt.txt (также есть в директории)
![](/9-10/tests/out_alt.png)


Пример запуска с конфигурационным файлом:

```bash
./main -c config1.txt -o out_alt_cfg.txt
```

Результат:
![](/9-10/tests/test2.png)

Вид out_alt.txt (также есть в директории)
![](/9-10/tests/out_alt_cfg.png)

---

## 20. Вывод по уровню 9–10 баллов

В рамках выполнения задания:

* разработаны **две независимые реализации** одной и той же задачи;
* использованы **разные синхропримитивы POSIX**;
* выполнены все требования уровня **9–10 баллов**.

---

## 21. Информация о проделанной работе

В ходе выполнения задания:

* реализована многопоточная модель взаимодействия «клиент–сервер»;
* изучены и применены механизмы активного ожидания и атомарных операций;
* обеспечена корректная синхронизация потоков и безопасный вывод данных;
* реализована обработка внешнего прерывания и корректное завершение программы;
* проведено тестирование программы при различных входных данных.

---